const data = [
    {
        "maHP": "KC118",
        "data": [
            {
                "ki_hieu": "01",
                "thu": "6",
                "tiet_bd": 6,
                "so_tiet": 3,
                "phong": "208/B1",
                "si_so": 70,
                "si_so_con_lai": 17,
                "tuan_hoc": "123456789012345******",
                "lop_hp": "KC118001"
            }
        ]
    },
    {
        "maHP": "KC356",
        "data": [
            {
                "ki_hieu": "01",
                "thu": "5",
                "tiet_bd": 6,
                "so_tiet": 2,
                "phong": "206/B1",
                "si_so": 90,
                "si_so_con_lai": 3,
                "tuan_hoc": "123456789012345******",
                "lop_hp": "KC356001"
            }
        ]
    },
    {
        "maHP": "CN151",
        "data": [
            {
                "ki_hieu": "01",
                "thu": "5",
                "tiet_bd": 8,
                "so_tiet": 2,
                "phong": "105/A3",
                "si_so": 77,
                "si_so_con_lai": 0,
                "tuan_hoc": "123456789012345******",
                "lop_hp": "CN151001"
            },
            {
                "ki_hieu": "01",
                "thu": "2",
                "tiet_bd": 4,
                "so_tiet": 2,
                "phong": "206/B1",
                "si_so": 92,
                "si_so_con_lai": 1,
                "tuan_hoc": "123456789012345******",
                "lop_hp": "CN151002"
            }
        ]
    },
    {
        "maHP": "KC346",
        "data": [
            {
                "ki_hieu": "01",
                "thu": "2",
                "tiet_bd": 8,
                "so_tiet": 2,
                "phong": "204/B1",
                "si_so": 90,
                "si_so_con_lai": 0,
                "tuan_hoc": "123456789012345******",
                "lop_hp": "KC346001"
            },
            {
                "ki_hieu": "01",
                "thu": "3",
                "tiet_bd": 8,
                "so_tiet": 2,
                "phong": "211/B1",
                "si_so": 90,
                "si_so_con_lai": 0,
                "tuan_hoc": "123456789012345******",
                "lop_hp": "KC346001"
            }
        ]
    },
    {
        "maHP": "ML018",
        "data": [
            {
                "ki_hieu": "01",
                "thu": "2",
                "tiet_bd": 4,
                "so_tiet": 2,
                "phong": "HT/KSP",
                "si_so": 201,
                "si_so_con_lai": 1,
                "tuan_hoc": "123456789012345******",
                "lop_hp": "ML01801"
            },
            {
                "ki_hieu": "02",
                "thu": "6",
                "tiet_bd": 6,
                "so_tiet": 2,
                "phong": "102/KH",
                "si_so": 160,
                "si_so_con_lai": 1,
                "tuan_hoc": "123456789012345******",
                "lop_hp": "ML01802"
            },
            {
                "ki_hieu": "03",
                "thu": "6",
                "tiet_bd": 8,
                "so_tiet": 2,
                "phong": "102/KH",
                "si_so": 160,
                "si_so_con_lai": 0,
                "tuan_hoc": "123456789012345******",
                "lop_hp": "ML01803"
            },
            {
                "ki_hieu": "04",
                "thu": "5",
                "tiet_bd": 1,
                "so_tiet": 2,
                "phong": "103/KH",
                "si_so": 160,
                "si_so_con_lai": 0,
                "tuan_hoc": "123456789012345******",
                "lop_hp": "ML01804"
            },
            {
                "ki_hieu": "05",
                "thu": "2",
                "tiet_bd": 1,
                "so_tiet": 2,
                "phong": "101/KT",
                "si_so": 200,
                "si_so_con_lai": 0,
                "tuan_hoc": "123456789012345******",
                "lop_hp": "ML01805"
            },
            {
                "ki_hieu": "06",
                "thu": "6",
                "tiet_bd": 1,
                "so_tiet": 2,
                "phong": "103/KH",
                "si_so": 160,
                "si_so_con_lai": 0,
                "tuan_hoc": "123456789012345******",
                "lop_hp": "ML01806"
            },
            {
                "ki_hieu": "07",
                "thu": "5",
                "tiet_bd": 6,
                "so_tiet": 2,
                "phong": "201/KH",
                "si_so": 160,
                "si_so_con_lai": 0,
                "tuan_hoc": "123456789012345******",
                "lop_hp": "ML01807"
            },
            {
                "ki_hieu": "08",
                "thu": "5",
                "tiet_bd": 8,
                "so_tiet": 2,
                "phong": "101/KH",
                "si_so": 160,
                "si_so_con_lai": 0,
                "tuan_hoc": "123456789012345******",
                "lop_hp": "ML01808"
            },
            {
                "ki_hieu": "09",
                "thu": "3",
                "tiet_bd": 4,
                "so_tiet": 2,
                "phong": "107/C1",
                "si_so": 210,
                "si_so_con_lai": 0,
                "tuan_hoc": "123456789012345******",
                "lop_hp": "ML01809"
            },
            {
                "ki_hieu": "10",
                "thu": "4",
                "tiet_bd": 1,
                "so_tiet": 2,
                "phong": "101/KT",
                "si_so": 200,
                "si_so_con_lai": 0,
                "tuan_hoc": "123456789012345******",
                "lop_hp": "ML01810"
            },
            {
                "ki_hieu": "11",
                "thu": "3",
                "tiet_bd": 6,
                "so_tiet": 2,
                "phong": "103/KH",
                "si_so": 160,
                "si_so_con_lai": 0,
                "tuan_hoc": "123456789012345******",
                "lop_hp": "ML01811"
            },
            {
                "ki_hieu": "12",
                "thu": "3",
                "tiet_bd": 8,
                "so_tiet": 2,
                "phong": "102/KH",
                "si_so": 160,
                "si_so_con_lai": 0,
                "tuan_hoc": "123456789012345******",
                "lop_hp": "ML01812"
            },
            {
                "ki_hieu": "13",
                "thu": "4",
                "tiet_bd": 1,
                "so_tiet": 2,
                "phong": "HT/KSP",
                "si_so": 200,
                "si_so_con_lai": 0,
                "tuan_hoc": "123456789012345******",
                "lop_hp": "ML01813"
            },
            {
                "ki_hieu": "14",
                "thu": "5",
                "tiet_bd": 6,
                "so_tiet": 2,
                "phong": "202/KH",
                "si_so": 160,
                "si_so_con_lai": 0,
                "tuan_hoc": "123456789012345******",
                "lop_hp": "ML01814"
            },
            {
                "ki_hieu": "15",
                "thu": "5",
                "tiet_bd": 8,
                "so_tiet": 2,
                "phong": "201/KH",
                "si_so": 160,
                "si_so_con_lai": 0,
                "tuan_hoc": "123456789012345******",
                "lop_hp": "ML01815"
            },
            {
                "ki_hieu": "16",
                "thu": "3",
                "tiet_bd": 1,
                "so_tiet": 2,
                "phong": "102/KH",
                "si_so": 160,
                "si_so_con_lai": 0,
                "tuan_hoc": "123456789012345******",
                "lop_hp": "ML01816"
            },
            {
                "ki_hieu": "17",
                "thu": "2",
                "tiet_bd": 8,
                "so_tiet": 2,
                "phong": "101/KT",
                "si_so": 200,
                "si_so_con_lai": 0,
                "tuan_hoc": "123456789012345******",
                "lop_hp": "ML01817"
            },
            {
                "ki_hieu": "18",
                "thu": "3",
                "tiet_bd": 6,
                "so_tiet": 2,
                "phong": "101/KH",
                "si_so": 160,
                "si_so_con_lai": 0,
                "tuan_hoc": "123456789012345******",
                "lop_hp": "ML01818"
            },
            {
                "ki_hieu": "19",
                "thu": "3",
                "tiet_bd": 8,
                "so_tiet": 2,
                "phong": "103/KH",
                "si_so": 160,
                "si_so_con_lai": 0,
                "tuan_hoc": "123456789012345******",
                "lop_hp": "ML01819"
            },
            {
                "ki_hieu": "20",
                "thu": "2",
                "tiet_bd": 6,
                "so_tiet": 2,
                "phong": "201/KH",
                "si_so": 160,
                "si_so_con_lai": 0,
                "tuan_hoc": "123456789012345******",
                "lop_hp": "ML01820"
            },
            {
                "ki_hieu": "H01",
                "thu": "7",
                "tiet_bd": 2,
                "so_tiet": 4,
                "phong": "101/HA",
                "si_so": 90,
                "si_so_con_lai": 10,
                "tuan_hoc": "12345678*************",
                "lop_hp": "21V1A5"
            },
            {
                "ki_hieu": "H02",
                "thu": "6",
                "tiet_bd": 2,
                "so_tiet": 4,
                "phong": "104/HA",
                "si_so": 80,
                "si_so_con_lai": 13,
                "tuan_hoc": "12345678*************",
                "lop_hp": "21U7A5"
            },
            {
                "ki_hieu": "H03",
                "thu": "7",
                "tiet_bd": 2,
                "so_tiet": 4,
                "phong": "101/HA",
                "si_so": 90,
                "si_so_con_lai": 47,
                "tuan_hoc": "********9012345******",
                "lop_hp": "2123A5"
            },
            {
                "ki_hieu": "H04",
                "thu": "6",
                "tiet_bd": 2,
                "so_tiet": 4,
                "phong": "201HA6",
                "si_so": 80,
                "si_so_con_lai": 3,
                "tuan_hoc": "********9012345******",
                "lop_hp": "2122A5"
            }
        ]
    },
    {
        "maHP": "CN100",
        "data": [
            {
                "ki_hieu": "01",
                "thu": "6",
                "tiet_bd": 1,
                "so_tiet": 3,
                "phong": "308/CN",
                "si_so": 90,
                "si_so_con_lai": 34,
                "tuan_hoc": "123456789012345******",
                "lop_hp": "CN100001"
            },
            {
                "ki_hieu": "02",
                "thu": "4",
                "tiet_bd": 6,
                "so_tiet": 3,
                "phong": "308/CN",
                "si_so": 91,
                "si_so_con_lai": 4,
                "tuan_hoc": "123456789012345******",
                "lop_hp": "CN100002"
            },
            {
                "ki_hieu": "03",
                "thu": "5",
                "tiet_bd": 1,
                "so_tiet": 3,
                "phong": "109/B1",
                "si_so": 60,
                "si_so_con_lai": 13,
                "tuan_hoc": "123456789012345******",
                "lop_hp": "CN100003"
            },
            {
                "ki_hieu": "C01",
                "thu": "2",
                "tiet_bd": 1,
                "so_tiet": 3,
                "phong": "109/B1",
                "si_so": 5,
                "si_so_con_lai": 0,
                "tuan_hoc": "*********0123**678***",
                "lop_hp": "22T6A1"
            },
            {
                "ki_hieu": "C01",
                "thu": "4",
                "tiet_bd": 4,
                "so_tiet": 2,
                "phong": "111/B1",
                "si_so": 5,
                "si_so_con_lai": 0,
                "tuan_hoc": "*********0123**678***",
                "lop_hp": "22T6A1"
            },
            {
                "ki_hieu": "D01",
                "thu": "5",
                "tiet_bd": 1,
                "so_tiet": 3,
                "phong": "104/B1",
                "si_so": 5,
                "si_so_con_lai": 0,
                "tuan_hoc": "*********012345**8***",
                "lop_hp": "22Z5A1"
            },
            {
                "ki_hieu": "D01",
                "thu": "6",
                "tiet_bd": 4,
                "so_tiet": 2,
                "phong": "103/B1",
                "si_so": 5,
                "si_so_con_lai": 0,
                "tuan_hoc": "*********012345**8***",
                "lop_hp": "22Z5A1"
            },
            {
                "ki_hieu": "M01",
                "thu": "7",
                "tiet_bd": 1,
                "so_tiet": 3,
                "phong": "314ATL",
                "si_so": 40,
                "si_so_con_lai": 10,
                "tuan_hoc": "123456789012345******",
                "lop_hp": "TN21T5F1"
            },
            {
                "ki_hieu": "M02",
                "thu": "3",
                "tiet_bd": 1,
                "so_tiet": 3,
                "phong": "314ATL",
                "si_so": 40,
                "si_so_con_lai": 19,
                "tuan_hoc": "123456789012345******",
                "lop_hp": "TN21T5F2"
            }
        ]
    },
    {
        "maHP": "CN169",
        "data": [
            {
                "ki_hieu": "01",
                "thu": "<b>Không có thời khóa biểu</b>",
                "tiet_bd": 100,
                "so_tiet": 56,
                "phong": "123456789012345******",
                "si_so": null,
                "si_so_con_lai": 2,
                "tuan_hoc": "M01",
                "lop_hp": "<b>Không có thời khóa biểu</b>"
            }
        ]
    }
]


let Status = [];

for (let item of data) {
  let maHP = item.maHP;
  let groups = [];
  for (let i = 0; i < item.data.length; i++) {
    let ki_hieu = item.data[i].ki_hieu;
    groups.push({ [ki_hieu]: true });
  }
  Status.push({ [maHP]: { status: true, groups: groups, numGroups: item.data.length } });
}

console.log(Status);


function createSubjectElement(subject) {
    const subjectDetails = document.createElement('details');
    subjectDetails.classList.add('tree-nav__item', 'is-expandable');
  
    const subjectSummary = document.createElement('summary');
    subjectSummary.classList.add('tree-nav__item-title', 'subject');
    subjectSummary.textContent = subject.maHP;
    subjectSummary.id = subject.maHP;
  
    const subjectCheckbox = document.createElement('input');
    subjectCheckbox.type = 'checkbox';
    subjectCheckbox.classList = 'sub-'+ subject.maHP;
    subjectCheckbox.addEventListener('change', () => {
      selectAllGroups(subjectDetails, subjectCheckbox.checked);
    });
  
    subjectSummary.appendChild(subjectCheckbox);
    subjectDetails.appendChild(subjectSummary);
  
    const groupedData = groupDataByKiHieu(subject.data);
  
    for (const kiHieu in groupedData) {
      if (groupedData.hasOwnProperty(kiHieu)) {
        const groupElement = createGroupElement(groupedData[kiHieu], subject.maHP);
        subjectDetails.appendChild(groupElement);
      }
    }
  
    return subjectDetails;
  }
  
  function createGroupElement(group, parentID) {
    const groupDetails = document.createElement('details');
    groupDetails.classList.add('tree-nav__item', 'is-expandable');
  
    const groupSummary = document.createElement('summary');
    groupSummary.classList.add('tree-nav__item-title');
    groupSummary.id = group[0].ki_hieu;
    groupSummary.textContent = `Nhóm ${group[0].ki_hieu}`;
  
    const groupCheckbox = document.createElement('input');
    groupCheckbox.classList.add('group-checkbox');
    groupCheckbox.type = 'checkbox';
  
    groupSummary.appendChild(groupCheckbox);
  
    groupCheckbox.addEventListener('click', () => {
      xulyData(groupSummary.id, groupCheckbox.checked, parentID);
    });
  
    groupDetails.appendChild(groupSummary);
  
    const groupTable = createGroupTable(group, parentID);
    groupDetails.appendChild(groupTable);
  
    return groupDetails;
  }
  
  function createGroupTable(group, parentID) {
    const groupTable = document.createElement('table');
    groupTable.style.width = '100%';
  
    const tableHeader = document.createElement('tr');
    tableHeader.innerHTML = `
      <th>Kí hiệu</th>
      <th>Thứ</th>
      <th>Tiết BĐ</th>
      <th>Số tiết</th>
      <th>Phòng</th>
      <th>Sỉ số</th>
      <th>Còn lại</th>
      <th>Lớp HP</th>
    `;
  
    groupTable.appendChild(tableHeader);
  
    group.forEach(data => {
      const tableRow = document.createElement('tr');
      tableRow.innerHTML = `
        <td>${data.ki_hieu}</td>
        <td>${data.thu}</td>
        <td>${data.tiet_bd}</td>
        <td>${data.so_tiet}</td>
        <td>${data.phong}</td>
        <td>${data.si_so}</td>
        <td>${data.si_so_con_lai}</td>
        <td>${data.lop_hp}</td>
      `;
      groupTable.appendChild(tableRow);
    });
  
    return groupTable;
  }
  
  function groupDataByKiHieu(data) {
    const groupedData = {};
  
    data.forEach(item => {
      if (groupedData.hasOwnProperty(item.ki_hieu)) {
        groupedData[item.ki_hieu].push(item);
      } else {
        groupedData[item.ki_hieu] = [item];
      }
    });
  
    return groupedData;
  }
  
  // Code phần khác giữ nguyên
  
  const treeNav = document.querySelector('.tree-nav');
  const danhSachMonHoc = document.createElement('details');
  danhSachMonHoc.classList.add('tree-nav__item', 'is-expandable');
  
  const danhSachMonHocSummary = document.createElement('summary');
  danhSachMonHocSummary.classList.add('tree-nav__item-title');
  danhSachMonHocSummary.textContent = 'Danh sách môn học';
  
  danhSachMonHoc.appendChild(danhSachMonHocSummary);
  
  data.forEach(subject => {
    const subjectElement = createSubjectElement(subject);
    danhSachMonHoc.appendChild(subjectElement);
  });
  
  treeNav.appendChild(danhSachMonHoc);

  
  function xulyData(id, status, parentID) {
    console.log(parentID, id, status);
    document.querySelector('.sub-'+ parentID).checked = true;

    const firstSubject = Status[0];
    const numGroups = firstSubject[parentID].numGroups;

    console.log(numGroups);
  }

  function selectAllGroups(subjectDetails, checked) {
    const groupCheckboxes = subjectDetails.querySelectorAll('.group-checkbox');
    groupCheckboxes.forEach(checkbox => {
      checkbox.checked = checked;
      // Perform additional logic if needed for each group checkbox
      // ...
    });
  }
